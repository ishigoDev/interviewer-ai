#!/usr/bin/env sh
echo "Running linter on staged files..."

# Get staged files matching the patterns
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM -- '*.js' '*.jsx' '*.ts' '*.tsx')

# If there are no staged files to lint, exit successfully.
if [ -z "$STAGED_FILES" ]; then
    echo "No relevant files to lint."
    exit 0
fi

# Run eslint on the staged files. The --fix flag attempts to fix issues automatically.
npx eslint --fix $STAGED_FILES

# Check the exit code of the eslint command.
if [ $? -ne 0 ]; then
  echo "ESLint found errors that could not be fixed automatically. Please fix them manually and then stage the changes."
  exit 1
fi

# If eslint was successful and made fixes, the changes are in the working directory.
# We need to add these changes to the staging area to include them in the commit.
echo "$STAGED_FILES" | xargs git add

echo "Linting complete and fixes staged."
exit 0